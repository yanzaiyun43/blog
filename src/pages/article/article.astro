---
// å¯¼å…¥é¡¹ç›®å·²æœ‰çš„å·¥å…·å‡½æ•°ã€å¸ƒå±€å’Œæ ·å¼ï¼Œæ— éœ€é¢å¤–å®‰è£…ä¾èµ–
import { getCollection } from "astro:content";
import { fmtTime, getDescription } from "@/utils/index";
import Layout from "@/layouts/Layout/Layout.astro";
import getCover from "@/utils/getCover";
import SITE_CONFIG from "@/config";

// é¡µé¢åŸºç¡€é…ç½®ï¼ˆå¤ç”¨ç«™ç‚¹é…ç½®ï¼Œä¿æŒé£æ ¼ç»Ÿä¸€ï¼‰
const { Title, Site } = SITE_CONFIG;
const pageTitle = "æ–‡ç« æ±‡æ€» | " + Title;
const pageDescription = "æ”¶å½•" + Site + "æ‰€æœ‰åŸåˆ›æ–‡ç« ï¼ŒæŒ‰å‘å¸ƒæ—¶é—´å€’åºæ’åˆ—";

// è·å–æ‰€æœ‰ blog é›†åˆçš„æ–‡ç« ï¼ˆè¿‡æ»¤æœªå‘å¸ƒ+æŒ‰æ—¥æœŸå€’åºï¼‰
const posts = await getCollection("blog", ({ data }) => {
  // åªæ˜¾ç¤ºå·²å‘å¸ƒçš„æ–‡ç« ï¼ˆå¦‚æœä½ çš„æ–‡ç« æœ‰ published å­—æ®µï¼Œæ²¡æœ‰å¯åˆ é™¤è¿™ä¸ªè¿‡æ»¤æ¡ä»¶ï¼‰
  return data.published !== false;
}).then((list) => 
  list.sort((a, b) => new Date(b.data.date) - new Date(a.data.date)) // æœ€æ–°æ–‡ç« åœ¨å‰
);
---

<!-- å¤ç”¨ç°æœ‰ Layoutï¼Œä¿æŒé¡µé¢å¤´éƒ¨ã€å¯¼èˆªã€åº•éƒ¨ç»Ÿä¸€ -->
<Layout 
  title={pageTitle} 
  keywords="æ–‡ç« åˆ—è¡¨,åŸåˆ›å†…å®¹,æŠ€æœ¯åˆ†äº«" 
  description={pageDescription}
>
  <div class="article-list-container vh-animation vh-animation-init">
    <!-- é¡µé¢æ ‡é¢˜æ  -->
    <div class="article-list-header">
      <h1>ğŸ“š æ–‡ç« æ±‡æ€»</h1>
      <p class="subtitle">å…± {posts.length} ç¯‡åŸåˆ›å†…å®¹ï¼ŒæŒç»­æ›´æ–°ä¸­...</p>
    </div>

    <!-- æ–‡ç« åˆ—è¡¨ä¸»ä½“ -->
    <div class="article-list-grid">
      {posts.length > 0 ? (
        posts.map((post) => (
          <a 
            href={`/article/${post.data.id}`} 
            class="article-card"
            title={post.data.title}
          >
            {/* æ–‡ç« å°é¢å›¾ï¼ˆå¤ç”¨è¯¦æƒ…é¡µçš„ getCover å·¥å…·ï¼Œé€‚é…å°é¢é…ç½®ï¼‰ */}
            {post.data.cover && (
              <div class="article-card-cover">
                <img 
                  src={await getCover(post.data.cover)} 
                  alt={post.data.title + " å°é¢"}
                  loading="lazy"
                />
              </div>
            )}
            {/* æ–‡ç« æ ¸å¿ƒä¿¡æ¯ */}
            <div class="article-card-content">
              <span class="article-card-category">{post.data.categories}</span>
              <h3 class="article-card-title">{post.data.title}</h3>
              <p class="article-card-excerpt">
                {/* ä¼˜å…ˆæ˜¾ç¤ºæ‘˜è¦ï¼Œæ²¡æœ‰åˆ™æ˜¾ç¤ºæ–‡ç« æè¿°ï¼ˆå¤ç”¨ getDescription å·¥å…·ï¼‰ */}
                {post.data.summary || getDescription(post)}
              </p>
              {/* æ–‡ç« å…ƒä¿¡æ¯ï¼ˆæ—¥æœŸ+é˜…è¯»æ—¶é—´ï¼‰ */}
              <div class="article-card-meta">
                <time>{fmtTime(post.data.date, "YYYY-MM-DD")}</time>
                {/* é˜…è¯»æ—¶é—´ä» remark æ’ä»¶è·å–ï¼Œæ²¡æœ‰åˆ™æ˜¾ç¤ºé»˜è®¤å€¼ */}
                <span>
                  {post.data.reading_time 
                    ? parseFloat((Number(post.data.reading_time) || 0).toFixed(1).replace(/\.0+$/, "")) + "åˆ†é’Ÿ" 
                    : "5åˆ†é’Ÿ"}
                </span>
              </div>
            </div>
          </a>
        ))
      ) : (
        <!-- æ— æ–‡ç« æ—¶çš„å ä½æç¤º -->
        <div class="no-articles">
          <p>æš‚æ— å·²å‘å¸ƒçš„æ–‡ç« ï¼Œå¿«å»åˆ›å»ºç¬¬ä¸€ç¯‡å§ï¼</p>
        </div>
      )}
    </div>
  </div>

  <!-- å¼•å…¥åˆ—è¡¨é¡µä¸“å±æ ·å¼ï¼ˆå¦‚æœéœ€è¦è‡ªå®šä¹‰æ ·å¼ï¼Œåˆ›å»ºè¿™ä¸ªæ–‡ä»¶å³å¯ï¼‰ -->
  <style lang="less">
    .article-list-container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1.5rem;

      .article-list-header {
        text-align: center;
        margin-bottom: 3rem;

        h1 {
          font-size: 2.2rem;
          margin-bottom: 0.8rem;
          color: #2d3748;
        }

        .subtitle {
          font-size: 1rem;
          color: #718096;
        }
      }

      .article-list-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
      }

      .article-card {
        display: flex;
        flex-direction: column;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden;
        color: #2d3748;
        text-decoration: none;

        &:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        .article-card-cover {
          height: 180px;
          overflow: hidden;

          img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
          }

          &:hover img {
            transform: scale(1.05);
          }
        }

        .article-card-content {
          padding: 1.5rem;
          flex: 1;
          display: flex;
          flex-direction: column;

          .article-card-category {
            display: inline-block;
            font-size: 0.8rem;
            padding: 0.3rem 0.6rem;
            background: #f5fafe;
            color: #4299e1;
            border-radius: 4px;
            margin-bottom: 0.8rem;
            width: fit-content;
          }

          .article-card-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            line-height: 1.4;
          }

          .article-card-excerpt {
            font-size: 0.95rem;
            color: #718096;
            line-height: 1.6;
            margin-bottom: 1rem;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
          }

          .article-card-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #a0aec0;
          }
        }
      }

      .no-articles {
        grid-column: 1 / -1;
        text-align: center;
        padding: 4rem 2rem;
        color: #718096;
        font-size: 1.1rem;
      }
    }

    /* å“åº”å¼é€‚é… */
    @media (max-width: 768px) {
      .article-list-container {
        .article-list-grid {
          grid-template-columns: 1fr;
        }

        .article-card-cover {
          height: 150px;
        }
      }
    }
  </style>
</Layout>
