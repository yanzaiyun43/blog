---
import SITE_CONFIG from "@/config";
// 只取需要的props，精简冗余
const { Title, Description, PageCover, datePublished, dateModified } = Astro.props;
// 规范网址，去除末尾斜杠
const canonicalData = new URL(Astro.url.pathname, Astro.site);
const canonicalURL = canonicalData.href.replace(/\/+$/, "");
// 解构站点配置
const { Site, Title: SiteName, Subtitle, Author, Cover, DNSOptimization } = SITE_CONFIG;
const WebTitle = Title ? `${Title} | ${SiteName}` : `${SiteName} - ${Subtitle}`;
const SiteCover = `${Site}${Cover}`;
const WebCover = PageCover ? `${Site}${PageCover}` : SiteCover;
// 固定关键词（按你要求，分词优化，SEO更友好）
const finalKeywords = ["旧识桥", "旧识桥博客", "博客", "技术分享", "开源阅读", "ailmel官网", "ailmel博客", "ailmel"];
// 日期优化：优先取文章传入日期，无则取当前时间（时区修正）
const getFormatDate = (date?: string) => date ? new Date(date).toISOString().replace("Z", "+08:00") : new Date().toISOString().replace("Z", "+08:00");
const pubDate = getFormatDate(datePublished);
const modDate = getFormatDate(dateModified);

// Schema结构化数据（符合百度+谷歌双收录规范）
const WebSiteData = { "@context":"https://schema.org", "@type":"WebSite", url:Site, name:SiteName, description:Subtitle, inLanguage:"zh-CN" };
const ArticleData = { "@context":"https://schema.org", "@type":"BlogPosting", mainEntityOfPage:{ "@type":"WebPage", "@id":canonicalURL }, headline:WebTitle, description:Description, image:[WebCover], datePublished:pubDate, dateModified:modDate, author:{ "@type":"Person", name:Author, url:Site }, publisher:{ "@type":"Organization", name:SiteName, logo:{ "@type":"ImageObject", url:SiteCover } }, keywords:finalKeywords.join(",") };

import "@/styles/Base.less";
---

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
	<!-- 核心SEO -->
	<title>{WebTitle}</title>
	<meta name="keywords" content={finalKeywords.join(", ")} />
	<meta name="description" content={Description || Subtitle} />
	<!-- 基础元信息 -->
	<meta name="author" content={Author} />
	<meta name="copyright" content={`©${new Date().getFullYear()} ${SiteName} 版权所有`} />
	<meta name="generator" content={Astro.generator} />
	<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
	<meta name="format-detection" content="telephone=no, email=no, date=no, address=no" />
	<!-- 渲染优化（简洁适配） -->
	<meta name="renderer" content="webkit" />
	<meta name="force-rendering" content="webkit" />
	<meta http-equiv="Cache-Control" content="no-transform" />
	<!-- 结构化数据（必加，SEO关键） -->
	<script type="application/ld+json" set:html={JSON.stringify(PageCover ? ArticleData : WebSiteData)} is:inline />
	<!-- Open Graph（社交分享优化） -->
	<meta property="og:type" content={PageCover ? "article" : "website"} />
	<meta property="og:site_name" content={SiteName} />
	<meta property="og:title" content={WebTitle} />
	<meta property="og:description" content={Description || Subtitle} />
	<meta property="og:url" content={canonicalURL} />
	<meta property="og:image" content={WebCover} />
	<meta property="og:image:width" content="1200" />
	<meta property="og:image:height" content="630" />
	<meta property="og:locale" content="zh_CN" />
	<!-- Twitter卡片（优化大图展示） -->
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:title" content={WebTitle} />
	<meta name="twitter:description" content={Description || Subtitle} />
	<meta name="twitter:image" content={WebCover} />
	<meta name="twitter:image:alt" content={WebTitle} />
	<!-- 站点关联 -->
	<link rel="canonical" href={canonicalURL} />
	<link rel="icon" type="image/x-icon" href="/favicon.ico" />
	<link rel="sitemap" type="application/xml" href="/sitemap-index.xml" />
	<!-- DNS预解析（精简无冗余） -->
	{DNSOptimization.map(url => <link rel="dns-prefetch" href={url} key={url} />)}
	{DNSOptimization.map(url => <link rel="preconnect" href={url} key={url} crossorigin />)}
	<!-- 插槽 -->
	<slot />
</head>
