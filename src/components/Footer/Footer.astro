---
import "./Footer.less";
---
<footer class="vh-footer">
  <main>
    <p>©2025-{new Date().getFullYear()} 旧识桥 | 本站稳定运行 <span class="web_time"></span></p>
    <p>
      <a href="/rss.xml" target="_blank">RSS订阅</a>
      <a href="/sitemap-index.xml" target="_blank">站点地图</a>
      
    </p>
    <p>
      <a href="https://icp.gov.moe/?keyword=20260678" target="_blank">萌ICP备20260678号</a>
    </p>
  </main>
</footer>

<!-- 网站运行时间 -->
<script is:inline>
  const startDate = new Date(2025, 11, 30, 21, 08, 12);
  const pad = n => n.toString().padStart(2, '0');

  document.addEventListener('DOMContentLoaded', () => {
    const el = document.querySelector('.web_time');
    if (!el) return;

    function update() {
      const diff = Date.now() - startDate;
      const d = Math.floor(diff / 86400000);
      const h = Math.floor((diff % 86400000) / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);
      el.textContent = `${d}天${pad(h)}时${pad(m)}分${pad(s)}秒`;
    }
    update();
    setInterval(update, 1000);
  });
</script>

<!-- 访客统计（每天自动更新 visitorId） -->
<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const countEl = document.getElementById('visitor-count');
    if (!countEl) return;

    // 读取本地存储
    let visitorId = localStorage.getItem('visitorId');
    let createTime = localStorage.getItem('visitorId_create_time');

    const now = Date.now();
    const thirtyDays = 1 * 24 * 60 * 60 * 1000; // 1天的毫秒数

    // 判断是否需要更新 visitorId
    let needNew = false;
    if (!visitorId || !createTime) {
      needNew = true;
    } else {
      const age = now - parseInt(createTime, 10);
      if (age > thirtyDays) {
        needNew = true;
      }
    }

    if (needNew) {
      // 生成新ID并记录创建时间
      visitorId = Math.random().toString(36).slice(2);
      createTime = now.toString();
      localStorage.setItem('visitorId', visitorId);
      localStorage.setItem('visitorId_create_time', createTime);
    }

    // 请求统计接口（替换成你自己的域名）
    fetch(`https://ailmel.dpdns.org/visit.php?api=1&visitorId=${visitorId}`)
      .then(res => res.json())
      .then(data => {
        if (data.total) {
          countEl.textContent = data.total;
        }
      })
      .catch(err => {
        countEl.textContent = '获取失败';
        console.error('统计接口错误:', err);
      });
  });
</script>
